
{
  "entities": {
    "CropBatch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CropBatch",
      "type": "object",
      "description": "Represents a batch of crops stored in a storage location, potentially across multiple areas.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CropBatch entity."
        },
        "cropType": {
          "type": "string",
          "description": "Type of crop in this batch (e.g., wheat, corn, rice)."
        },
        "areaAllocations": {
          "type": "array",
          "description": "An array detailing how the batch quantity is distributed across multiple storage areas.",
          "items": {
            "type": "object",
            "properties": {
              "areaId": {
                "type": "string"
              },
              "quantity": {
                "type": "number"
              }
            },
            "required": ["areaId", "quantity"]
          }
        },
        "storageLocationId": {
          "type": "string",
          "description": "Reference to StorageLocation. (Relationship: StorageLocation 1:N CropBatch)"
        },
        "dateAdded": {
          "type": "string",
          "description": "Date and time when the crop batch was added to storage.",
          "format": "date-time"
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this crop batch."
        },
        "customerId": {
          "type": "string",
          "description": "The ID of the customer who owns this batch."
        },
        "customerName": {
          "type": "string",
          "description": "The name of the customer for display purposes."
        },
        "labourCharge": {
            "type": "number",
            "description": "Total labour charge for the inflow of this batch."
        }
      },
      "required": [
        "id",
        "cropType",
        "areaAllocations",
        "storageLocationId",
        "dateAdded",
        "ownerId",
        "customerId",
        "customerName"
      ]
    },
    "StorageLocation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StorageLocation",
      "type": "object",
      "description": "Represents a storage location with a specific capacity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StorageLocation entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the storage location (e.g., Warehouse A, Silo 1)."
        },
        "capacity": {
          "type": "number",
          "description": "Maximum capacity of the storage location, in bags."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this storage location."
        },
        "mobileNumber": {
          "type": "string",
          "description": "Contact mobile number for the warehouse."
        },
        "address": {
          "type": "string",
          "description": "Physical address of the storage location."
        }
      },
      "required": [
        "id",
        "name",
        "capacity",
        "ownerId",
        "mobileNumber",
        "address"
      ]
    },
    "StorageArea": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StorageArea",
      "type": "object",
      "description": "Represents a specific area within a StorageLocation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StorageArea."
        },
        "name": {
          "type": "string",
          "description": "Name of the area (e.g., Section A-1, Bin 5)."
        },
        "capacity": {
          "type": "number",
          "description": "Maximum capacity of the area, in bags."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this area."
        },
        "storageLocationId": {
          "type": "string",
          "description": "The ID of the parent StorageLocation."
        }
      },
      "required": [
        "id",
        "name",
        "capacity",
        "ownerId",
        "storageLocationId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user, matching Firebase Auth UID."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "mobileNumber": {
          "type": "string",
          "description": "The user's mobile phone number."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the system.",
          "enum": ["admin", "manager", "assistant", "user"]
        }
      },
      "required": [
        "uid",
        "displayName",
        "email",
        "role"
      ]
    },
    "CropType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CropType",
      "type": "object",
      "description": "Represents a type of crop that can be stored, with custom storage rates.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CropType."
        },
        "name": {
          "type": "string",
          "description": "Name of the crop type (e.g., Wheat, Corn)."
        },
        "rates": {
          "type": "object",
          "description": "Storage rates for different durations.",
          "properties": {
            "1": { "type": "number", "description": "Rate for 1 month." },
            "6": { "type": "number", "description": "Rate for 6 months." },
            "12": { "type": "number", "description": "Rate for 12 months (1 year)." }
          },
          "required": ["1", "6", "12"]
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who created this crop type."
        }
      },
      "required": [
        "id",
        "name",
        "rates",
        "ownerId"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who stores crops.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer."
        },
        "name": {
          "type": "string",
          "description": "Name of the customer."
        },
        "mobileNumber": {
          "type": "string",
          "description": "Contact mobile number for the customer."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who manages this customer."
        }
      },
      "required": ["id", "name", "mobileNumber", "ownerId"]
    },
    "Outflow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Outflow",
      "type": "object",
      "description": "Represents an outflow transaction, including partial payments.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Outflow transaction."
        },
        "cropBatchId": {
          "type": "string",
          "description": "The ID of the CropBatch this outflow is from."
        },
        "customerId": {
          "type": "string",
          "description": "The ID of the customer."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who processed the outflow."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time of the outflow transaction."
        },
        "quantityWithdrawn": {
          "type": "number",
          "description": "The number of bags withdrawn in this transaction."
        },
        "totalBill": {
          "type": "number",
          "description": "The total amount billed for this specific transaction."
        },
        "amountPaid": {
          "type": "number",
          "description": "The amount paid by the customer in this transaction."
        },
        "balanceDue": {
          "type": "number",
          "description": "The remaining balance for this transaction (totalBill - amountPaid)."
        },
        "storageDuration": { "type": "number" },
        "storageCost": { "type": "number" },
        "labourCharge": { "type": "number" }
      },
      "required": [
        "id",
        "cropBatchId",
        "customerId",
        "ownerId",
        "date",
        "quantityWithdrawn",
        "totalBill",
        "amountPaid",
        "balanceDue",
        "storageDuration",
        "storageCost",
        "labourCharge"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a single payment transaction made towards an outflow.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment transaction."
        },
        "outflowId": {
          "type": "string",
          "description": "The ID of the Outflow this payment is for."
        },
        "customerId": {
          "type": "string",
          "description": "The ID of the customer making the payment."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who processed the payment."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time of the payment."
        },
        "amount": {
          "type": "number",
          "description": "The amount paid in this transaction."
        },
        "paymentMethod": {
          "type": "string",
          "description": "The method of payment (e.g., Cash, Card, Online)."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about the payment."
        }
      },
      "required": [
        "id",
        "outflowId",
        "customerId",
        "ownerId",
        "date",
        "amount",
        "paymentMethod"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/storageLocations/{storageLocationId}",
        "schema": { "$ref": "#/entities/StorageLocation" },
        "description": "Stores storage location information owned by a user."
      },
      {
        "path": "/storageLocations/{storageLocationId}/areas/{areaId}",
        "schema": { "$ref": "#/entities/StorageArea" },
        "description": "Stores specific areas within a storage location."
      },
      {
        "path": "/cropBatches/{cropBatchId}",
        "schema": { "$ref": "#/entities/CropBatch" },
        "description": "Stores crop batch information owned by a user."
      },
       {
        "path": "/outflows/{outflowId}",
        "schema": { "$ref": "#/entities/Outflow" },
        "description": "Stores outflow transaction records, including payments."
      },
      {
        "path": "/payments/{paymentId}",
        "schema": { "$ref": "#/entities/Payment" },
        "description": "Stores individual payment records for outflows."
      },
      {
        "path": "/users/{userId}",
        "schema": { "$ref": "#/entities/UserProfile" },
        "description": "Stores public user profile information."
      },
      {
        "path": "/cropTypes/{cropTypeId}",
        "schema": { "$ref": "#/entities/CropType" },
        "description": "Stores crop types defined by a user."
      },
      {
        "path": "/customers/{customerId}",
        "schema": { "$ref": "#/entities/Customer" },
        "description": "Stores customer information managed by a user."
      }
    ],
    "reasoning": "The Firestore structure is designed to manage crop batches and storage locations for the CropSafe application. It prioritizes Authorization Independence by storing all necessary authorization data directly within the documents, avoiding hierarchical dependencies and complex `get()` calls in security rules. Access control is implemented by leveraging an 'ownerId' field on each document. This structure supports secure `list` operations by ensuring that the security rules can query based on this 'ownerId'. A `users` collection is included to store user profile information, now with a 'role' for tiered access. A `cropTypes` collection is added to allow users to manage their own custom crop classifications, including custom storage rates. A `customers` collection is added to store information about the clients who own the crops. A subcollection for `areas` is added to each `storageLocation` to manage specific zones within a warehouse. A new top-level `outflows` collection is added to track individual withdrawal transactions and payments, providing a clear separation between inventory and financial records. A `payments` collection is now added to store individual payment records, providing a clear audit trail for all financial transactions."
  }
}
